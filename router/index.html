<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>Router - Cape.JS: Documentation</title>
  <meta name="generator" content="Bootply" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="http://oiax.github.io/capejs/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
  <link href="http://oiax.github.io/capejs/css/styles.css" rel="stylesheet">
  <link href="http://oiax.github.io/capejs/highlight/styles/default.css" rel="stylesheet">
  <link rel="shortcut icon" href="http://oiax.github.io/capejs/images/favicon_capejs.ico" type="image/vnd.microsoft.icon" />
  <link rel="icon" href="http://oiax.github.io/capejs/images/favicon_capejs.ico" type="image/vnd.microsoft.icon" />
</head>

<body>
<div id="navbar-md" class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <a href="/capejs/" class="navbar-brand">Cape.JS</a>
    </div>
    <nav role="navigation">
      <ul class="nav navbar-nav">
        <li><a href="http://oiax.github.io/capejs/api">API Reference</a></li>
        <li>
          <a href="https://github.com/oiax/capejs">GitHub Repository
          <i class="fa fa-external-link"></i></a>
        </li>
      </ul>
      <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".sidebar-nav">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </nav>
  </div>
</div>
<div id="navbar-sm" class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
      <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".sidebar-nav">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="http://oiax.github.io/capejs/" class="navbar-brand">Cape.JS Doc</a>
      <a href="http://oiax.github.io/capejs/api/" class="link">API</a>
      <a href="https://github.com/oiax/capejs" class="link">GitHub
      <i class="fa fa-external-link"></i></a>
  </div>
</div>

<div class="container">
  <div class="row row-offcanvas row-offcanvas-left">
    
        <div class="col-xs-12 col-md-3 sidebar-offcanvas" id="sidebar" role="navigation">
      <ul class="nav">
      
      
        <li><a href="http://oiax.github.io/capejs/#what-is">What is Cape.JS?</a></li>
      
        <li><a href="http://oiax.github.io/capejs/#installation">Installation</a></li>
      
        <li><a href="http://oiax.github.io/capejs/#faq">FAQ</a></li>
      
      
        <li>
          <a href="http://oiax.github.io/capejs/components">Components</a>
          
          <ul>
          
            <li><a href="http://oiax.github.io/capejs/components/#hello-world">Hello World</a></li>
          
            <li><a href="http://oiax.github.io/capejs/components/#es6">ECMAScript 6</a></li>
          
            <li><a href="http://oiax.github.io/capejs/components/#dom-tree">Building Virtual DOM Tree</a></li>
          
            <li><a href="http://oiax.github.io/capejs/components/#click-counter">Click Counter</a></li>
          
            <li><a href="http://oiax.github.io/capejs/components/#shortcut-methods">Shortcut Methods</a></li>
          
            <li><a href="http://oiax.github.io/capejs/components/#html-styles">HTML Styles</a></li>
          
            <li><a href="http://oiax.github.io/capejs/components/#todo-list">Todo List</a></li>
          
            <li><a href="http://oiax.github.io/capejs/components/#mixins">Mixins</a></li>
          
          </ul>
      
        <li>
          <a href="http://oiax.github.io/capejs/data_stores">Data Stores</a>
          
          <ul>
          
            <li><a href="http://oiax.github.io/capejs/data_stores/#basics">Basics</a></li>
          
            <li><a href="http://oiax.github.io/capejs/data_stores/#ajax">Ajax</a></li>
          
          </ul>
      
        <li>
          <a href="http://oiax.github.io/capejs/collection_agents">Collection Agents</a>
          
          <ul>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#basics">Basics</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#agent-adapters">Agent Adapters</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#defining-classes">Defining Classes</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#initialization">Initialization</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#creating-resources">Creating Resources</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#rest-operations">REST Operations</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#callbacks-and-error-handlers">Callbacks and Error Handlers</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#changing-path-prefix">Changing the Path Prefix</a></li>
          
            <li><a href="http://oiax.github.io/capejs/collection_agents/#options">Options</a></li>
          
          </ul>
      
        <li>
          <a href="http://oiax.github.io/capejs/resource_agents">Resource Agents</a>
          
          <ul>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#basics">Basics</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#agent-adapters">Agent Adapters</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#defining-classes">Defining Classes</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#creating-a-new-resource">Creating a New Resource</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#editing-a-resource">Editing a Resource</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#building-a-dual-use-form">Building a Dual-Use Form</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#deleting-a-resource">Deleting a Resource</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#specifying-a-callback">Specifying a Callback</a></li>
          
            <li><a href="http://oiax.github.io/capejs/resource_agents/#options">Options</a></li>
          
          </ul>
      
        <li>
          <a href="http://oiax.github.io/capejs/router">Router</a>
          
          <ul>
          
            <li><a href="http://oiax.github.io/capejs/router/#simple-routes">Simple Routes</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#containers">Containers</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#resource-based-routes">Resource Based Routes</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#singular-resources">Singular Resources</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#nested-resources">Nested Resources</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#namespaces">Namespaces</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#adding-custom-actions">Adding Custom Actions</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#changing-root-container">Changing Root Container</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#vars">Vars</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#flash">Flash</a></li>
          
            <li><a href="http://oiax.github.io/capejs/router/#before-navigation-callbacks">Before-Navigation Callbacks</a></li>
          
          </ul>
      
        <li>
          <a href="http://oiax.github.io/capejs/tutorials">Tutorials and Demos</a>
          
          <ul>
          
            <li><a href="http://oiax.github.io/capejs/tutorials/#setting-up-rails-with-capejs">Setting up Rails with Cape.JS</a></li>
          
          </ul>
      
        <li><a href="http://oiax.github.io/capejs/api">API Reference</a></li>
      </ul>
    </div>

    
    <div class="col-sm-12 col-md-9">
      <article>
        <header>
          <h2>Router</h2>
          <div class="post-meta clearfix">
          </div>
        </header>
        <div>
          

<p><a href="#simple-routes">Simple Routes</a> -
<a href="#containers">Containers</a> -
<a href="#resource-based-routes">Resource Based Routes</a> -
<a href="#singular-resources">Singular Resources</a> -
<a href="#nested-resources">Nested Resources</a> -
<a href="#namespaces">Namespaces</a> -
<a href="#adding-custom-actions">Adding Custom Actions</a> -
<a href="#changing-root-container">Changing Root Container</a> -
<a href="#vars">Vars</a> -
<a href="#flash">Flash</a> -
<a href="#before-navigation-callbacks">Before-Navigation Callbacks</a></p>

<p><a class="anchor" id="simple-routes"></a></p>

<h3 id="simple-routes:b440f93c1d3adda104fcdb9ed5aa5063">Simple Routes</h3>

<p>Cape.JS&rsquo;s router reacts to the changes of URL hash fragment and replace the
component mounted on the target node.</p>

<p>The following example illustrates the basic concept of router and routes.</p>

<h4 id="index-html:b440f93c1d3adda104fcdb9ed5aa5063">index.html</h4>

<pre><code class="language-html">&lt;div&gt;
  &lt;a href=&quot;#&quot;&gt;Top&lt;/a&gt;
  &lt;a href=&quot;#about&quot;&gt;About&lt;/a&gt;
  &lt;a href=&quot;#help&quot;&gt;Help&lt;/a&gt;
&lt;/div&gt;

&lt;div id=&quot;main&quot;&gt;&lt;/div&gt;

&lt;script src=&quot;./components.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./router.js&quot;&gt;&lt;/script&gt;
</code></pre>

<h4 id="components-js:b440f93c1d3adda104fcdb9ed5aa5063">components.js</h4>

<pre><code class="language-javascript">var TopPage = Cape.createComponentClass({
  render: function(m) {
    m.p('This is the top page.')
  }
});

var AboutPage = Cape.createComponentClass({
  render: function(m) {
    m.p('This is the about page.')
  }
});

var HelpPage = Cape.createComponentClass({
  render: function(m) {
    m.p('This is the help page.')
  }
});
</code></pre>

<h4 id="router-js:b440f93c1d3adda104fcdb9ed5aa5063">router.js</h4>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.root('top_page');
  m.page('about', 'about_page');
  m.page('help', 'help_page');
})
router.mount('main');
router.start();
</code></pre>

<p><code>m.root('top_page')</code> connects the empty hash to the component <code>TopPage</code>
so that the browser displays the top page when we open this site.</p>

<p><code>m.page('about', 'about_page')</code> connects the hash <code>#about</code> to the component <code>AboutPage</code>.
When we click the &lsquo;About&rsquo; link, the <code>TopPage</code> component is removed and
the <code>AboutPage</code> component gets mounted.</p>

<p>Each connection between a hash and a component is called <em>route.</em>
The <em>router</em> continues to watch the changes of URL hash and switches
components according to the routes.</p>

<p>You can find the source code of working demo on
<a href="https://github.com/oiax/capejs/tree/master/demo/simple_routes">https://github.com/oiax/capejs/tree/master/demo/simple_routes</a>.</p>

<p><a class="anchor" id="containers"></a></p>

<h3 id="containers:b440f93c1d3adda104fcdb9ed5aa5063">Containers</h3>

<p>When the number of components is getting larger, you may want to organize
them in a hyerarchical structure. In this case, you can create some objects
to contain component classes as follows:</p>

<pre><code class="language-javascript">var Top = {};
Top.IndexPage = Cape.createComponentClass({
  render: function(m) {
    m.p('This is the top page.')
  }
});

Top.AboutPage = Cape.createComponentClass({
  render: function(m) {
    m.p('This is the about page.')
  }
});

Top.HelpPage = Cape.createComponentClass({
  render: function(m) {
    m.p('This is the help page.')
  }
});
</code></pre>

<p>We call objects of this kind <em>containers</em>.</p>

<p>When you define routes to classes under a container, you should connect
the container&rsquo;s name and the class name with a dot like this:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.root('top.index_page');
  m.page('about', 'top.about_page');
  m.page('help', 'top.help_page');
})
</code></pre>

<p><a class="anchor" id="resource-based-routes"></a></p>

<h3 id="resource-based-routes:b440f93c1d3adda104fcdb9ed5aa5063">Resource Based Routes</h3>

<p>When you create a user interface for CRUD operations on a database table, say <code>articles</code>,
you will need four pages typically:</p>

<ol>
<li>A page for listing articles</li>
<li>A page for showing the details of an existing article</li>
<li>A page to add a new article</li>
<li>A page to update an existing article</li>
</ol>

<p>As a framework, Cape.JS recommends you to create following routes for these pages:</p>

<ol>
<li><code>articles =&gt; Articles.List</code></li>
<li><code>articles/:id =&gt; Articles.Item</code></li>
<li><code>articles/new =&gt; Articles.Form</code></li>
<li><code>articles/:id/edit =&gt; Articles.Form</code></li>
</ol>

<p>In line with this, you will create three component classes under a container called <code>Articles</code>
and define routes as follows:</p>

<pre><code>var router = new Cape.Router();
router.draw(function(m) {
  m.page('articles', 'articles.list');
  m.page('articles/:id', 'articles.item');
  m.page('articles/new', 'articles.form');
  m.page('articles/:id/edit', 'articles.form');
})
</code></pre>

<p>Using <code>many</code> method, you can define them in much easier way, though.</p>

<pre><code>var router = new Cape.Router();
router.draw(function(m) {
  m.many('articles');
})
</code></pre>

<p>The routes defined by the above code are summarized in the next table:</p>

<table class="table">
<tr>
  <th>Hash pattern</th>
  <th>Container</th>
  <th>Component</th>
  <th>Resource</th>
  <th>Action</th>
</tr>
<tr>
  <td>articles</td>
  <td>Articles</td>
  <td>List</td>
  <td>articles</td>
  <td>index</td>
</tr>
<tr>
  <td>articles/:id</td>
  <td>Articles</td>
  <td>Item</td>
  <td>articles</td>
  <td>show</td>
</tr>
<tr>
  <td>articles/new</td>
  <td>Articles</td>
  <td>Form</td>
  <td>articles</td>
  <td>new</td>
</tr>
<tr>
  <td>articles/:id/edit</td>
  <td>Articles</td>
  <td>Form</td>
  <td>articles</td>
  <td>edit</td>
</tr>
</table>

<p>The fourth and fifth rows of the table contain the <em>resource name</em> and <em>action name</em> of routes.
In Cape.JS, unlike in Ruby on Rails, the concepts of resource and action don&rsquo;t play important role,
but we use them occasionally.</p>

<p>Firstly, we specify action names to the <code>only</code> and <code>except</code> option in order
to exclude some routes from definition:</p>

<pre><code>var router = new Cape.Router();
router.draw(function(m) {
  m.many('articles', except: [ 'new', 'edit' ]);
  m.many('announcement', only: [ 'index' ]);
})
</code></pre>

<p>Secondly, we want to know the current resource and action names in order to
control the flow of processing when we render components:</p>

<pre><code class="language-javascript">Articles.Form = Cape.createComponentClass({
  render: function(m) {
    if (router.action === 'new') {
      // ...
    }
    else {
      // ...
    }
  }
});
</code></pre>

<p><a class="anchor" id="singular-resources"></a></p>

<h3 id="singular-resources:b440f93c1d3adda104fcdb9ed5aa5063">Singular Resources</h3>

<p>When you want to define routes for a resource that can have only zero or
one instance, you should use <code>one</code> method as follows:</p>

<pre><code>var router = new Cape.Router();
router.draw(function(m) {
  m.one('account');
})
</code></pre>

<p>The routes defined by the above code are summarized in the next table:</p>

<table class="table">
<tr>
  <th>Hash pattern</th>
  <th>Container</th>
  <th>Component</th>
  <th>Resource</th>
  <th>Action</th>
</tr>
<tr>
  <td>account</td>
  <td>Account</td>
  <td>Content</td>
  <td>account</td>
  <td>show</td>
</tr>
<tr>
  <td>account/new</td>
  <td>Account</td>
  <td>Form</td>
  <td>account</td>
  <td>new</td>
</tr>
<tr>
  <td>account/edit</td>
  <td>Account</td>
  <td>Form</td>
  <td>account</td>
  <td>edit</td>
</tr>
</table>

<p>Note that the naming convension is different from that of Ruby on Rails.
The container&rsquo;s name is singular, not plural.</p>

<p><a class="anchor" id="nested-resources"></a></p>

<h3 id="nested-resources:b440f93c1d3adda104fcdb9ed5aa5063">Nested Resources</h3>

<p>You can define resources which are logically children
of other resources as follows:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.many('articles', { only: [] }, function(m) {
    m.many('comments')
  });
})
</code></pre>

<p>The routes defined by the above code are summarized in the next table:</p>

<table class="table">
<tr>
  <th>Hash pattern</th>
  <th>Container</th>
  <th>Component</th>
  <th>Resource</th>
  <th>Action</th>
</tr>
<tr>
  <td>articles/:article_id/comments</td>
  <td>Comments</td>
  <td>List</td>
  <td>articles/comments</td>
  <td>index</td>
</tr>
<tr>
  <td>articles/:article_id/comments/:id</td>
  <td>Comments</td>
  <td>Item</td>
  <td>articles/comments</td>
  <td>show</td>
</tr>
<tr>
  <td>articles/:article_id/comments/new</td>
  <td>Comments</td>
  <td>Form</td>
  <td>articles/comments</td>
  <td>new</td>
</tr>
<tr>
  <td>articles/:article_id/comments/:id/edit</td>
  <td>Comments</td>
  <td>Form</td>
  <td>articles/comments</td>
  <td>edit</td>
</tr>
</table>

<p>Note that you should define <code>Comments.List</code>, <code>Comments.Item</code> and <code>Comments.Form</code>.
They are not <code>Articles.Comments.List</code>, <code>Articles.Comments.Item</code> and <code>Articles.Comments.Form</code>.</p>

<p><a class="anchor" id="namespaces"></a></p>

<h3 id="namespaces:b440f93c1d3adda104fcdb9ed5aa5063">Namespaces</h3>

<p>You can define resources under a <em>namespace</em> as follows:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.namespace('admin', function(m) {
    m.many('articles');
  })
})
</code></pre>

<p>The routes defined by the above code are summarized in the next table:</p>

<table class="table">
<tr>
  <th>Hash pattern</th>
  <th>Container</th>
  <th>Component</th>
  <th>Namespace</th>
  <th>Resource</th>
  <th>Action</th>
</tr>
<tr>
  <td>admin/articles</td>
  <td>Admin.Articles</td>
  <td>List</td>
  <td>admin</td>
  <td>articles</td>
  <td>index</td>
</tr>
<tr>
  <td>admin/articles/:id</td>
  <td>Admin.Articles</td>
  <td>Item</td>
  <td>admin</td>
  <td>articles</td>
  <td>show</td>
</tr>
<tr>
  <td>admin/articles/new</td>
  <td>Admin.Articles</td>
  <td>Form</td>
  <td>admin</td>
  <td>articles</td>
  <td>new</td>
</tr>
<tr>
  <td>admin/articles/:id/edit</td>
  <td>Admin.Articles</td>
  <td>Form</td>
  <td>admin</td>
  <td>articles</td>
  <td>edit</td>
</tr>
</table>

<p><a class="anchor" id="adding-custom-actions"></a></p>

<h3 id="adding-custom-actions:b440f93c1d3adda104fcdb9ed5aa5063">Adding Custom Actions</h3>

<h4 id="adding-collection-routes:b440f93c1d3adda104fcdb9ed5aa5063">Adding Collection Routes</h4>

<p>To add a <em>collection</em> route (a route which deals with multiple items), use <code>collection</code> method:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.many('articles', function(m) {
    m.collection 'draft'
  });
})
</code></pre>

<p>This defines a route from <code>articles/draft</code> to <code>Articles.Draft</code>.</p>

<h4 id="adding-member-routes:b440f93c1d3adda104fcdb9ed5aa5063">Adding Member Routes</h4>

<p>To add a <em>member</em> route (a route which deals with a specific item), use <code>member</code> method:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.many('articles', function(m) {
    m.member 'info'
  });
})
</code></pre>

<p>This defines a route from <code>articles/:id/info</code> to <code>Articles.Info</code>.</p>

<h4 id="adding-routes-for-additional-new-actions:b440f93c1d3adda104fcdb9ed5aa5063">Adding Routes for Additional New Actions</h4>

<p>To add an alternate new action, use <code>new</code> method:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.many('articles', function(m) {
    m.new 'preview'
  });
})
</code></pre>

<p>This defines a route from <code>articles/new/preview</code> to <code>Articles.Preview</code>.</p>

<h4 id="adding-additional-routes-to-singular-resources:b440f93c1d3adda104fcdb9ed5aa5063">Adding Additional Routes to Singular Resources</h4>

<p>To add an additional route to singular resources, use <code>view</code> method:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.one('account', function(m) {
    m.view 'photo'
  });
})
</code></pre>

<p>This defines a route from <code>account/photo</code> to <code>Account.Photo</code>.</p>

<h4 id="adding-routes-for-additional-new-actions-of-singular-resources:b440f93c1d3adda104fcdb9ed5aa5063">Adding Routes for Additional New Actions of Singular Resources</h4>

<p>To add an alternate new action to singular resources, use <code>new</code> method:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.draw(function(m) {
  m.one('account', function(m) {
    m.new 'preview'
  });
})
</code></pre>

<p>This defines a route from <code>account/new/preview</code> to <code>Account.Preview</code>.</p>

<p><a class="anchor" id="changing-root-container"></a></p>

<h3 id="changing-root-container:b440f93c1d3adda104fcdb9ed5aa5063">Changing Root Container</h3>

<p>By default, the root container is <code>window</code> object.
In other words, variables for components and containers are defined globally.</p>

<p>But you can change it by passing an object to the <code>Cape.Router</code>&rsquo;s constructor:</p>

<pre><code class="language-javascript">var MyApp = {};
var router = new Cape.Router(MyApp);
router.draw(function(m) {
  m.root('top_page')
  m.many('articles');
})
</code></pre>

<p>Then the component class for root page becomes <code>MyApp.TopPage</code>,
and the container for the <code>articles</code> resource becomes <code>MyApp.Articles</code>.</p>

<p><a class="anchor" id="vars"></a></p>

<h3 id="vars:b440f93c1d3adda104fcdb9ed5aa5063">Vars</h3>

<p>Routers have a property named <code>vars</code>, which developers can store arbitrary data to.</p>

<p>For example, you can store attributes of the current user:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.vars.current_user = { id: 123, name: 'john', privileged: true }
</code></pre>

<p>You can use this data in the <code>render</code> method of a component like this:</p>

<pre><code class="language-javascript">render: function(m) {
  if (router.vars.current_user.privileged)
    m.attr(onclick: function(e) { this.deleteItem() } );
  else
    m.class('disabled')
  m.button('Delete');
}
</code></pre>

<p><a class="anchor" id="flash"></a></p>

<h3 id="flash:b440f93c1d3adda104fcdb9ed5aa5063">Flash</h3>

<p>Routers have a property named <code>flash</code>, which developers can store arbitrary data to,
but is erased after each navigation.</p>

<p>For example, you can store the alert message to be displayed in the next page:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.flash.alert = &quot;You can't delete this item.&quot;;
</code></pre>

<p>You can use this data in the <code>render</code> method of a component like this:</p>

<pre><code class="language-javascript">render: function(m) {
  if (router.flash.alert !== undefined) {
    m.div(router.flash.alert, { class: 'alert' });
  }
}
</code></pre>

<p><a class="anchor" id="before-navigation-callbacks"></a></p>

<h3 id="before-navigation-callbacks:b440f93c1d3adda104fcdb9ed5aa5063">Before-Navigation Callbacks</h3>

<p>You can register one or more callbacks which are executed before each <em>navigation</em>.</p>

<p>Here is an example:</p>

<pre><code class="language-javascript">var router = new Cape.Router();
router.beforeNavigation(function(hash) {
  return new Promise(function(resolve, reject) {
    $.ajax({
      type: 'GET',
      url: '/session'
    }).done(function(data) {
      if (data.text == 'OK') {
        router.vars.currentUser = data.user;
        resolve(hash);
      }
      else {
        router.vars.currentUser = null;
        resolve('login');
      }
    }).error(function() {
      reject(Error('ERROR'));
    });
  });
});
router.errorHandler(function(err) {
  router.show(Errors.NetworkError);
});
</code></pre>

<p>In the above code, we get attributes of the user who is signing in to this
application through an Ajax request.</p>

<p>The <code>resolve</code> and <code>reject</code> are functions.
If we call the <code>resolve</code> passing a hash as the first argument,
the process continues to the next callback which takes this hash as its first argument.
When all callbacks are executed successfully, the hash which is specified by the last callback
determines the component to be mounted.</p>

<p>If we call the <code>reject</code> method, the next and subsequent callbacks are skipped and
the error handler is executed if it exists.</p>

<p>The <code>show</code> method of router mounts the specified component (<code>Errors.NetworkError</code>)
immediately without executing before-navigation callbacks.</p>

        </div>
      </article>
    </div>
  </div>
</div>

<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="http://oiax.github.io/capejs/js/bootstrap.min.js"></script>
<script src="http://oiax.github.io/capejs/js/scripts.js"></script>
<script src="http://oiax.github.io/capejs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<div id="footer-sm" class="footer navbar-fixed-bottom">
  <div>Copyright &copy; 2015 <a href="http://www.oiax.jp/">Oiax, Inc.</a> and contributors.</div>
</div>
<div id="footer-xs" class="footer">
  <div>Copyright &copy; 2015 <a href="http://www.oiax.jp/">Oiax, Inc.</a> and contributors.</div>
</div>

</body>
</html>
